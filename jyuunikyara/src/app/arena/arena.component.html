<mat-card class="message-box" *ngIf="!initialCharSelect && !gameOver">
  <mat-card-header>
    <mat-card-title i18n="Prompt asking who won the round">Who won?</mat-card-title>
  </mat-card-header>
  <mat-card-content>

    <mat-grid-list cols="2" rowHeight="1:1">
      <div class="centered-overlay vs-overlay">vs</div>
      <mat-grid-tile class="character-tile"
          matRipple
          [ngClass]="{'round-winner': roundWinner == 'player1', 'round-loser': roundWinner == 'player2', 'selectable': (player1Selected && player2Selected)}"
          (click)="playerCharClicked('player1')">
          <div class="char-background"
              [style.background-image]="player1Selected ? 'url(assets/icons/sekirei/' + player1Selected.name + '.png)' : ''">
            <span *ngFor="let stock of range(p1RemainingStocks)">ðŸ’Ž</span>
          </div>
      </mat-grid-tile>
      <mat-grid-tile class="character-tile"
          matRipple
          [ngClass]="{'round-winner': roundWinner == 'player2', 'round-loser': roundWinner == 'player1', 'selectable': (player1Selected && player2Selected)}"
          (click)="playerCharClicked('player2')">
          <div class="char-background"
              [style.background-image]="player2Selected ? 'url(assets/icons/sekirei/' + player2Selected.name + '.png)' : ''">
            <span *ngFor="let stock of range(p2RemainingStocks)">ðŸ’Ž</span>
          </div>
      </mat-grid-tile>
    </mat-grid-list>
    <div *ngIf="roundWinner">
    <p i18n style="font-size: 13pt">How many stocks remaining?</p>

    <div>
    <button mat-stroked-button
        i18n="Number of stocks"
        class="button-row"
        color="primary"
        *ngFor="let r of range(initialStockCount)"
        [disabled]="(roundWinner == 'player1') ? (p1RemainingStocks < r + 1) : (p2RemainingStocks < r + 1)"
        (click)="maybeSetRemainingStocks(!(roundWinner == 'player1' ? (p1RemainingStocks < r + 1) : (p2RemainingStocks < r + 1)), r+1); submitRound()">
      {{r + 1}}
    </button>
    </div>
    </div>
    
  </mat-card-content>
</mat-card>

<div class="wrapper">
<app-character-grid
    [playerName]="player1Name"
    i18n-playerNamePlaceholder
    playerNamePlaceholder="Player 1"
    [selectedCharacter]="player1Selected"
    [playerSnapshot]="snapshot.player1"
    [selectMode]="p1SelectMode"
    (clickCharacter)="characterClicked('player1', $event)"
    [readyToFight]="player1Selected && !player2Selected && initialCharSelect"
    [initialStockCount]="initialStockCount"></app-character-grid>

<app-character-grid
    [playerName]="player2Name"
    i18n-playerNamePlaceholder
    playerNamePlaceholder="Player 2"
    [selectedCharacter]="player2Selected"
    [playerSnapshot]="snapshot.player2"
    [selectMode]="p2SelectMode"
    (clickCharacter)="characterClicked('player2', $event)"
    [readyToFight]="player2Selected && !player1Selected && initialCharSelect"
    [initialStockCount]="initialStockCount"></app-character-grid>
</div>

<br>

<mat-card class="message-box" *ngIf="gameOver">
<mat-card-header>
  <mat-card-title i18n="Heading for a battle replay">Replay</mat-card-title>
</mat-card-header>
<mat-card-content>

<mat-grid-list cols="2" rowHeight="2:1">
  <ng-container *ngFor="let round of getHistory(); let i = index">
    <mat-grid-tile>
        <div class="char-background-slice" 
            [ngClass]="{'faded-bg': (i != 0 && round.player2Character != getHistory()[i-1].player2Character)}"
            [style.background-image]="'url(assets/icons/sekirei/' + round.player1Character + '.png)'"></div>
        <div style="margin-top: auto; margin-bottom: auto" *ngIf="!(i == 0 || round.player1Character != getHistory()[i-1].player1Character)">
          <span *ngFor="let stock of range(getHistory()[i-1].remainingStocks)">ðŸ’Ž</span>
        </div>
    </mat-grid-tile>
    <mat-grid-tile>
      <div class="char-background-slice" 
          [ngClass]="{'faded-bg': (i != 0 && round.player1Character != getHistory()[i-1].player1Character)}"
          [style.background-image]="'url(assets/icons/sekirei/' + round.player2Character + '.png)'"></div>
        <div style="margin-top: auto; margin-bottom: auto" *ngIf="!(i == 0 || round.player2Character != getHistory()[i-1].player2Character)">
          <span *ngFor="let stock of range(getHistory()[i-1].remainingStocks)">ðŸ’Ž</span>
        </div>
    </mat-grid-tile>
  </ng-container>

  <mat-grid-tile 
      class="char-background-slice">
      <div style="margin-top: auto; margin-bottom: auto" *ngIf="getHistory()[getHistory().length-1].winner == 'player1'">
        <span *ngFor="let stock of range(getHistory()[getHistory().length-1].remainingStocks)">ðŸ’Ž</span>
      </div>
  </mat-grid-tile>
  <mat-grid-tile
      class="char-background-slice">
      <div style="margin-top: auto; margin-bottom: auto" *ngIf="getHistory()[getHistory().length-1].winner == 'player2'">
        <span *ngFor="let stock of range(getHistory()[getHistory().length-1].remainingStocks)">ðŸ’Ž</span>
      </div>
  </mat-grid-tile>
</mat-grid-list>

</mat-card-content>
</mat-card>
